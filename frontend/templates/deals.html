{% extends "base.html" %}

{% block title %}Deals | ShopHub Affiliate{% endblock %}

{% block content %}
<section class="products-section">
    <div class="container">
        <div class="products-header">
            <h2>Deals</h2>
            <p>Limitedâ€‘time affiliate discounts.</p>
        </div>
        <div class="products-grid">
            {% if products %}
                {% for product in products %}
                {% set primary_image = (product.image_urls[0] if product.image_urls and product.image_urls|length > 0 else (product.image_url or '')) %}
                <div class="product-card" data-product-id="{{ product.id }}">
                    <div class="product-media">
                        <span class="product-tag">Deal</span>
                        <img src="{{ primary_image }}" alt="{{ product.name }}" class="product-image">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">{{ product.name }}</h3>
                        <p class="product-description">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                        <div class="product-footer">
                            {% if product.deal_price %}
                            <span class="product-price">${{ '%.2f'|format(product.deal_price) }}</span>
                            {% else %}
                            <span class="product-price">${{ '%.2f'|format(product.price) }}</span>
                            {% endif %}
                            <a class="affiliate-btn" href="{{ product.affiliate_url or '#' }}" target="_blank" rel="noopener">Grab Deal</a>
                        </div>
                        <a class="detail-link" href="/product/{{ product.id }}">View Details</a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="empty-products">No deals available.</p>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
