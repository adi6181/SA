{% extends "base.html" %}

{% block title %}ShopHub Affiliate | Home{% endblock %}

{% block content %}
<header class="hero">
    <div class="container hero-layout">
        <div class="hero-copy">
            <p class="hero-overline">Affiliate Picks</p>
            <h1>Find topâ€‘rated products, reviews, and deals in one place.</h1>
            <p>We curate products from Amazon and ShareASale so you can buy directly from trusted stores.</p>
            <div class="hero-actions">
                <a class="btn btn-primary" href="/deals">Browse Deals</a>
                <a class="btn btn-outline" href="/reviews">Read Reviews</a>
            </div>
        </div>
        <div class="hero-visual">
            <div class="hero-card">
                <img src="{{ url_for('static', filename='images/running_shoes.svg') }}" alt="featured product">
                <span>Top Rated</span>
            </div>
            <div class="hero-card secondary">
                <img src="{{ url_for('static', filename='images/wireless_headphones.svg') }}" alt="featured product">
                <span>Best Deals</span>
            </div>
        </div>
    </div>
</header>

<section class="collections-strip">
    <div class="container collections-grid">
        <button class="collection-chip active" data-category="">Shop All</button>
        <button class="collection-chip" data-category="Electronics">Electronics</button>
        <button class="collection-chip" data-category="Fashion">Fashion</button>
        <button class="collection-chip" data-category="Home">Home</button>
        <button class="collection-chip" data-category="Books">Books</button>
    </div>
</section>

<section id="products" class="products-section">
    <div class="container">
        <div class="products-header">
            <h2>Featured Picks</h2>
            <p>Curated affiliate products with trusted merchants.</p>
        </div>
        <div class="filters">
            <input type="text" id="searchInput" class="search-input" list="searchSuggestions" placeholder="Search products...">
            <datalist id="searchSuggestions"></datalist>
            <select id="categoryFilter" class="category-filter">
                <option value="">All Categories</option>
                <option value="Electronics">Electronics</option>
                <option value="Fashion">Fashion</option>
                <option value="Home">Home</option>
                <option value="Books">Books</option>
            </select>
            <select id="sortFilter" class="category-filter">
                <option value="newest">Newest</option>
                <option value="price_asc">Price: Low to High</option>
                <option value="price_desc">Price: High to Low</option>
                <option value="name_asc">Name: A-Z</option>
                <option value="rating_desc">Top Rated</option>
                <option value="popular_desc">Most Reviewed</option>
                <option value="deals_desc">Best Deals</option>
            </select>
            <input type="number" id="minPriceFilter" class="category-filter" min="0" step="0.01" placeholder="Min price">
            <input type="number" id="maxPriceFilter" class="category-filter" min="0" step="0.01" placeholder="Max price">
        </div>
        <div class="quick-filters">
            <button type="button" class="quick-chip" data-filter-chip="deals">Deals Only</button>
            <button type="button" class="quick-chip" data-filter-chip="rating">4+ Rated</button>
        </div>
        <div class="active-filters" id="activeFilters"></div>
        <div class="products-grid" id="productsGrid">
            {%- if products is defined and products|length > 0 -%}
                {%- for product in products -%}
                {% set primary_image = (product.image_urls[0] if product.image_urls and product.image_urls|length > 0 else (product.image_url or '')) %}
                <div class="product-card"
                    data-product-id="{{ product.id }}"
                    data-product-name="{{ product.name | e }}"
                    data-product-category="{{ product.category or '' }}"
                    data-image-urls='{{ product.image_urls | tojson if product.image_urls is defined else "[]" }}'>
                    <div class="product-media">
                        <span class="product-tag">{{ product.category or 'General' }}</span>
                        <img src="{{ primary_image }}" alt="{{ product.name }}" class="product-image" data-image-index="0">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">{{ product.name }}</h3>
                        <p class="product-description">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                        <div class="product-footer">
                            <span class="product-price">${{ '%.2f'|format(product.price) }}</span>
                            <a class="affiliate-btn" href="{{ product.affiliate_url or '#' }}" target="_blank" rel="noopener">Shop Now</a>
                        </div>
                    </div>
                </div>
                {%- endfor -%}
            {%- else -%}
                <p class="empty-products">No products found.</p>
            {%- endif -%}
        </div>
    </div>
</section>
{% endblock %}
