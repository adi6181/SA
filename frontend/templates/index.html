{% extends "base.html" %}

{% block title %}ShopHub Affiliate | Home{% endblock %}

{% block content %}
<header class="hero">
    <div class="container hero-layout">
        <div class="hero-copy">
            <p class="hero-overline">Affiliate Picks</p>
            <h1>Find top‑rated products, reviews, and deals in one place.</h1>
            <p>We curate products from Amazon and ShareASale so you can buy directly from trusted stores.</p>
            <div class="hero-actions">
                <a class="btn btn-primary" href="/deals">Browse Deals</a>
                <a class="btn btn-outline" href="/reviews">Read Reviews</a>
            </div>
        </div>
        <div class="hero-collage" id="heroCollage">
            <div class="hero-layer layer-back" data-parallax-layer="0.12">
                <img src="{{ url_for('static', filename='images/wireless_headphones.svg') }}" alt="Wireless headphones">
            </div>
            <div class="hero-layer layer-mid" data-parallax-layer="0.2">
                <img src="{{ url_for('static', filename='images/running_shoes.svg') }}" alt="Running shoes">
            </div>
            <div class="hero-layer layer-front" data-parallax-layer="0.32">
                <img src="{{ url_for('static', filename='images/smartwatch.svg') }}" alt="Smartwatch">
            </div>
            <div class="hero-layer layer-accent" data-parallax-layer="0.18">
                <img src="{{ url_for('static', filename='images/led_desk_lamp.svg') }}" alt="Desk lamp">
            </div>

            <button type="button" class="hero-hotspot hotspot-one" data-hotspot-category="Electronics" data-hotspot-label="Electronics Picks">
                Shop the look · Electronics
            </button>
            <button type="button" class="hero-hotspot hotspot-two" data-hotspot-category="Fashion" data-hotspot-label="Fashion Picks">
                Shop the look · Fashion
            </button>
            <button type="button" class="hero-hotspot hotspot-three" data-hotspot-category="Home" data-hotspot-label="Home Picks">
                Shop the look · Home
            </button>
        </div>
    </div>
</header>

<section class="collections-strip">
    <div class="container collections-grid">
        <button class="collection-chip active" data-category="">Shop All</button>
        <button class="collection-chip" data-category="Electronics">Electronics</button>
        <button class="collection-chip" data-category="Fashion">Fashion</button>
        <button class="collection-chip" data-category="Home">Home</button>
        <button class="collection-chip" data-category="Books">Books</button>
    </div>
</section>

<section id="products" class="products-section">
    <div class="container">
        <div class="products-header">
            <h2>Featured Picks</h2>
            <p>Curated affiliate products with trusted merchants.</p>
        </div>
        <div class="filters">
            <input type="text" id="searchInput" class="search-input" list="searchSuggestions" placeholder="Search products...">
            <datalist id="searchSuggestions"></datalist>
            <select id="categoryFilter" class="category-filter">
                <option value="">All Categories</option>
                <option value="Electronics">Electronics</option>
                <option value="Fashion">Fashion</option>
                <option value="Home">Home</option>
                <option value="Books">Books</option>
            </select>
            <select id="sortFilter" class="category-filter">
                <option value="newest">Newest</option>
                <option value="price_asc">Price: Low to High</option>
                <option value="price_desc">Price: High to Low</option>
                <option value="name_asc">Name: A-Z</option>
                <option value="rating_desc">Top Rated</option>
                <option value="popular_desc">Most Reviewed</option>
                <option value="deals_desc">Best Deals</option>
            </select>
            <input type="number" id="minPriceFilter" class="category-filter" min="0" step="0.01" placeholder="Min price">
            <input type="number" id="maxPriceFilter" class="category-filter" min="0" step="0.01" placeholder="Max price">
        </div>
        <div class="quick-filters">
            <button type="button" class="quick-chip" data-filter-chip="deals">Deals Only</button>
            <button type="button" class="quick-chip" data-filter-chip="rating">4+ Rated</button>
        </div>
        <div class="active-filters" id="activeFilters"></div>
        <section class="ai-copilot" id="aiCopilot">
            <div class="ai-copilot-head">
                <h3>AI Copilot</h3>
                <p>Use natural language or one-click AI actions to discover products faster.</p>
            </div>
            <div class="ai-copilot-actions">
                <button type="button" class="quick-chip" id="aiExplainQueryBtn">Interpret My Search</button>
                <button type="button" class="quick-chip" id="aiAutoCompareBtn">AI Auto-Compare Top Matches</button>
            </div>
            <div class="ai-copilot-prompts">
                <button type="button" class="ai-prompt-chip" data-ai-query="best deals under 100">Best deals under $100</button>
                <button type="button" class="ai-prompt-chip" data-ai-query="top rated electronics">Top rated electronics</button>
                <button type="button" class="ai-prompt-chip" data-ai-query="fashion below 75">Fashion below $75</button>
                <button type="button" class="ai-prompt-chip" data-ai-query="home products above 50">Home products above $50</button>
            </div>
        </section>
        <div class="compare-builder" id="compareBuilder">
            <div class="compare-head">
                <h3>Smart Comparison Builder</h3>
                <p>Select 2-4 products and generate an AI-style side-by-side comparison.</p>
            </div>
            <div class="compare-selected" id="compareSelected">No products selected.</div>
            <div class="compare-actions">
                <button type="button" class="btn btn-primary" id="runComparisonBtn" disabled>Compare Selected</button>
                <button type="button" class="btn btn-outline" id="clearComparisonBtn" disabled>Clear</button>
            </div>
            <div class="compare-results" id="comparisonResults"></div>
        </div>
        <div class="products-grid" id="productsGrid">
            {%- if products is defined and products|length > 0 -%}
                {%- for product in products -%}
                {% set primary_image = (product.image_urls[0] if product.image_urls and product.image_urls|length > 0 else (product.image_url or '')) %}
                <div class="product-card"
                    data-product-id="{{ product.id }}"
                    data-product-name="{{ product.name | e }}"
                    data-product-category="{{ product.category or '' }}"
                    data-image-urls='{{ product.image_urls | tojson if product.image_urls is defined else "[]" }}'>
                    <div class="product-media">
                        <span class="product-tag">{{ product.category or 'General' }}</span>
                        <img src="{{ primary_image }}" alt="{{ product.name }}" class="product-image" data-image-index="0">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">{{ product.name }}</h3>
                        <p class="product-description">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                        {% if product.why_this_product and product.why_this_product.reasons %}
                        <div class="why-card">
                            <p class="why-title">Why this product ({{ product.why_this_product.confidence }} confidence)</p>
                            <ul>
                                {% for reason in product.why_this_product.reasons %}
                                <li>{{ reason }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                        <div class="product-footer">
                            <span class="product-price">${{ '%.2f'|format(product.price) }}</span>
                            <a class="affiliate-btn" href="{{ product.affiliate_url or '#' }}" target="_blank" rel="noopener">Shop Now</a>
                        </div>
                    </div>
                </div>
                {%- endfor -%}
            {%- else -%}
                <p class="empty-products">No products found.</p>
            {%- endif -%}
        </div>
    </div>
</section>
{% endblock %}
